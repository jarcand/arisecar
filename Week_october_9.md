# Marc-Andre #

I refactor the architecture of the Simulation to add an HAL (Hardware abstraction layer). Basically, the HAL is an interface in Java that will be the same for the SimRobot and RealRobot, so if the code work with the SimRobot it will also work for the RealRobot. When a message is received from the server it start at the RobotClient, then is send to RobotMessageControl then is send at the HAL. The RobotMessageControl class decide what method of the HAL to call depending on the nature of the message.

I changed the code for passing message on the server. Since we want to run the server non stop, our modification must not affect the server. Since the only modification the server will see are new sort of message or modification to existing message, we need to find a way to send always the same type of message so we don't need to restart the server when new message are created. I had 2 options, the first one what to transform a message into a String and then reconstruct the message later. Since it is harder to work like that I chose to create a Message class which hold an HashMap of parameter. When you received the Message you just extract the data from the HashMap. To set the value of the HashMap I created a MessageFactory class responsible for creating the different message.

I integrate the XBoxController with the network code. It was a bit tricky because of the way you get input from the controller. You need to set up a while(true) loop and you poll() input from the controller everytime you pass in the loop. Unfortunately, you can't send information about the status of the controller everytime you pass into the loop because it will be too much data for the network. So you need to reduce the number of information that you send to the server. To do that, I had 2 options : the first one was to send information in interval of X time. But if the time is too short the network became freeze and if the interval is too long, the response of the robot will be sloppy. So I choose the second option which was to only send the status of the controller when it changed enough to make a little difference in the robot movement. That way we send way less data.

I also did various test and bug fix through my code but I'm not yet done with that. Although the simulation seems to run fine currently.

The Network code for the server is ready, so we only need to set up the server box somewhere and we have our server to control the robot.